apiVersion: cluster.x-k8s.io/v1beta1
kind: Cluster
metadata:
  annotations:
    caren.nutanix.com/cluster-uuid: 01993287-1556-787d-9f8a-0855aa5b2f81
  creationTimestamp: "2025-09-10T07:34:48Z"
  finalizers:
  - cluster.cluster.x-k8s.io
  generation: 2
  labels:
    cluster.x-k8s.io/cluster-name: trg-nkp-mgt
    cluster.x-k8s.io/provider: nutanix
    konvoy.d2iq.io/cluster-name: trg-nkp-mgt
    konvoy.d2iq.io/provider: nutanix
    topology.cluster.x-k8s.io/owned: ""
  name: trg-nkp-mgt
  namespace: default
  resourceVersion: "94736077"
  uid: 71a556a7-58f4-4b50-b1e8-ac0e065f4041
spec:
  clusterNetwork:
    pods:
      cidrBlocks:
      - 10.210.0.0/16
    services:
      cidrBlocks:
      - 10.200.0.0/16
  controlPlaneEndpoint:
    host: 172.16.101.10
    port: 6443
  controlPlaneRef:
    apiVersion: controlplane.cluster.x-k8s.io/v1beta1
    kind: KubeadmControlPlane
    name: trg-nkp-mgt-x7btl
    namespace: default
  infrastructureRef:
    apiVersion: infrastructure.cluster.x-k8s.io/v1beta1
    kind: NutanixCluster
    name: trg-nkp-mgt-5hp2g
    namespace: default
  topology:
    class: nkp-nutanix-v2.14.0
    controlPlane:
      metadata: {}
      replicas: 3
    variables:
    - name: clusterConfig
      value:
        addons:
          ccm:
            credentials:
              secretRef:
                name: trg-nkp-mgt-pc-credentials
            strategy: HelmAddon
          clusterAutoscaler:
            strategy: HelmAddon
          cni:
            provider: Cilium
            strategy: HelmAddon
          cosi:
            strategy: HelmAddon
          csi:
            defaultStorage:
              provider: nutanix
              storageClassConfig: volume
            providers:
              nutanix:
                credentials:
                  secretRef:
                    name: trg-nkp-mgt-pc-credentials-for-csi
                storageClassConfigs:
                  volume:
                    allowExpansion: true
                    parameters:
                      csi.storage.k8s.io/fstype: ext4
                      description: CSI StorageClass nutanix-volume for trg-nkp-mgt
                      flashMode: DISABLED
                      hypervisorAttached: ENABLED
                      storageContainer: SelfServiceContainer
                      storageType: NutanixVolumes
                    reclaimPolicy: Delete
                    volumeBindingMode: WaitForFirstConsumer
                strategy: HelmAddon
            snapshotController:
              strategy: HelmAddon
          nfd:
            strategy: HelmAddon
          serviceLoadBalancer:
            configuration:
              addressRanges:
              - end: 172.16.101.40
                start: 172.16.101.20
            provider: MetalLB
        controlPlane:
          nutanix:
            machineDetails:
              bootType: uefi
              cluster:
                name: trg-cluster
                type: name
              image:
                name: nkp-rhel-8.10-1.31.4-20250909083808
                type: name
              memorySize: 16Gi
              subnets:
              - name: nkp-mgt-overlay
                type: name
              systemDiskSize: 300Gi
              vcpuSockets: 4
              vcpusPerSocket: 1
        dns:
          coreDNS: {}
        encryptionAtRest:
          providers:
          - secretbox: {}
        globalImageRegistryMirror:
          credentials:
            secretRef:
              name: trg-nkp-mgt-image-registry-mirror-credentials
          url: https://harbor.ste.training/library
          fallbackRegistries:
            - url: http://172.16.109.168:8082
              credentials:
                secretRef:
                  name: nexus-fallback-secret
        containerdConfigPatches:
        - |-
          [plugins."io.containerd.grpc.v1.cri".registry]
            [plugins."io.containerd.grpc.v1.cri".registry.mirrors."172.16.109.168:8082"]
              endpoint = ["http://172.16.109.168:8082"]
            [plugins."io.containerd.grpc.v1.cri".registry.configs."172.16.109.168:8082".tls]
              insecure_skip_verify = true
        nutanix:
          controlPlaneEndpoint:
            host: 172.16.101.10
            port: 6443
            virtualIP:
              provider: KubeVIP
          prismCentralEndpoint:
            credentials:
              secretRef:
                name: trg-nkp-mgt-pc-credentials
            insecure: true
            url: https://central.ste.training:9440
        users:
        - name: konvoy
          sshAuthorizedKeys:
          - |
            ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC7RJwopRlGG6VZ92mDDfQSur6oyBosmsMGJ8CScob0X4hO8t0dvIBPHPA90N88O8naSPVojBWmy6jDkl3uu2RYySj7dji8iTl3lvfKNmSZdFQqPCIJM34tfTxCm1dHHHrAgb+MaERlOJNF7aS6bxZdiUYZvQitlZ4b9gRelWA4Yoi8rYPWp95KwqfDJdFmAa70NyNERidGhv3+HEqJCJC4AwR58cxiXzT0HCgrVFFhDRSokmocnM4TFCNbniuICpRFbMo6b+LXhO4ActF3BWKYPxLrNJjNgTFeMh1IHhEo50gTLNGOyzOFXz7mzaivsCwMGEVmDE5r+pzBSIaHkFeyhgdMvmPmsfNwEAogMPCM/WHDAkMQuY/nULX0+YO9Q2jaQolTfwylnY4aAC9T2aTb1jVaQ4XlrpxnHwMEN2PdKI9qFr1xicdPaz80arr1lcDQcDLwn6UK9BU31L0EQr1HAvsYeKIQVaz7i3w4N4CN7wt4+6N+BTdFHHd4pgOzd58=
          sudo: ALL=(ALL) NOPASSWD:ALL
    version: v1.31.4
    workers:
      machineDeployments:
      - class: default-worker
        metadata:
          annotations:
            cluster.x-k8s.io/cluster-api-autoscaler-node-group-max-size: "4"
            cluster.x-k8s.io/cluster-api-autoscaler-node-group-min-size: "4"
        name: md-0
        variables:
          overrides:
          - name: workerConfig
            value:
              nutanix:
                machineDetails:
                  bootType: uefi
                  cluster:
                    name: trg-cluster
                    type: name
                  image:
                    name: nkp-rhel-8.10-1.31.4-20250909083808
                    type: name
                  memorySize: 32Gi
                  subnets:
                  - name: nkp-mgt-overlay
                    type: name
                  systemDiskSize: 300Gi
                  vcpuSockets: 8
                  vcpusPerSocket: 1
status:
  conditions:
  - lastTransitionTime: "2025-09-10T07:34:57Z"
    status: "True"
    type: Ready
  - lastTransitionTime: "2025-09-10T07:34:56Z"
    status: "True"
    type: ControlPlaneInitialized
  - lastTransitionTime: "2025-09-10T07:34:57Z"
    status: "True"
    type: ControlPlaneReady
  - lastTransitionTime: "2025-09-10T07:34:55Z"
    status: "True"
    type: InfrastructureReady
  - lastTransitionTime: "2025-09-10T07:36:24Z"
    status: "True"
    type: KommanderInitialized
  - lastTransitionTime: "2025-09-10T07:34:56Z"
    status: "True"
    type: TopologyReconciled
  controlPlaneReady: true
  infrastructureReady: true
  observedGeneration: 2
  phase: Provisioned
  v1beta2:
    conditions:
    - lastTransitionTime: "2025-09-10T07:36:25Z"
      message: |-
        * WorkersAvailable:
          * MachineDeployment trg-nkp-mgt-md-0-fczl5: 0 available replicas, at least 4 required (spec.strategy.rollout.maxUnavailable is 0, spec.replicas is 4)
      observedGeneration: 2
      reason: NotAvailable
      status: "False"
      type: Available
    - lastTransitionTime: "2025-09-10T07:36:25Z"
      message: ""
      observedGeneration: 2
      reason: ProbeSucceeded
      status: "True"
      type: RemoteConnectionProbe
    - lastTransitionTime: "2025-09-10T07:36:25Z"
      message: ""
      observedGeneration: 2
      reason: Ready
      status: "True"
      type: InfrastructureReady
    - lastTransitionTime: "2025-09-10T07:36:25Z"
      message: ""
      observedGeneration: 2
      reason: Initialized
      status: "True"
      type: ControlPlaneInitialized
    - lastTransitionTime: "2025-10-10T03:05:50Z"
      message: ""
      observedGeneration: 2
      reason: Available
      status: "True"
      type: ControlPlaneAvailable
    - lastTransitionTime: "2025-09-10T07:36:25Z"
      message: '* MachineDeployment trg-nkp-mgt-md-0-fczl5: 0 available replicas,
        at least 4 required (spec.strategy.rollout.maxUnavailable is 0, spec.replicas
        is 4)'
      observedGeneration: 2
      reason: NotAvailable
      status: "False"
      type: WorkersAvailable
    - lastTransitionTime: "2025-09-10T07:36:25Z"
      message: ""
      observedGeneration: 2
      reason: ReconcileSucceeded
      status: "True"
      type: TopologyReconciled
    - lastTransitionTime: "2025-09-10T07:36:25Z"
      message: ""
      observedGeneration: 2
      reason: NotRollingOut
      status: "False"
      type: RollingOut
    - lastTransitionTime: "2025-09-10T07:36:25Z"
      message: ""
      observedGeneration: 2
      reason: NotRemediating
      status: "False"
      type: Remediating
    - lastTransitionTime: "2025-09-10T07:36:25Z"
      message: ""
      observedGeneration: 2
      reason: NotScalingDown
      status: "False"
      type: ScalingDown
    - lastTransitionTime: "2025-09-10T07:36:25Z"
      message: ""
      observedGeneration: 2
      reason: NotScalingUp
      status: "False"
      type: ScalingUp
    - lastTransitionTime: "2025-09-10T07:36:25Z"
      message: |-
        * Machines trg-nkp-mgt-x7btl-4sptp, trg-nkp-mgt-x7btl-qhlqc, trg-nkp-mgt-x7btl-r7cvn:
          * BootstrapConfigReady:
            * CertificatesAvailable: Condition not yet reported
      observedGeneration: 2
      reason: ReadyUnknown
      status: Unknown
      type: ControlPlaneMachinesReady
    - lastTransitionTime: "2025-09-10T07:36:25Z"
      message: |-
        * Machines trg-nkp-mgt-md-0-fczl5-bl654-76vdz, trg-nkp-mgt-md-0-fczl5-bl654-874lm, trg-nkp-mgt-md-0-fczl5-bl654-fprxr, ... (1 more):
          * BootstrapConfigReady:
            * CertificatesAvailable: Condition not yet reported
      observedGeneration: 2
      reason: ReadyUnknown
      status: Unknown
      type: WorkerMachinesReady
    - lastTransitionTime: "2025-09-10T07:36:25Z"
      message: ""
      observedGeneration: 2
      reason: UpToDate
      status: "True"
      type: ControlPlaneMachinesUpToDate
    - lastTransitionTime: "2025-09-10T07:36:25Z"
      message: ""
      observedGeneration: 2
      reason: UpToDate
      status: "True"
      type: WorkerMachinesUpToDate
    - lastTransitionTime: "2025-09-10T07:36:24Z"
      message: ""
      observedGeneration: 2
      reason: NotPaused
      status: "False"
      type: Paused
    - lastTransitionTime: "2025-09-10T07:36:25Z"
      message: ""
      observedGeneration: 2
      reason: NotDeleting
      status: "False"
      type: Deleting
    controlPlane:
      availableReplicas: 0
      desiredReplicas: 3
      readyReplicas: 0
      replicas: 3
      upToDateReplicas: 3
    workers:
      availableReplicas: 0
      desiredReplicas: 4
      readyReplicas: 0
      replicas: 4
      upToDateReplicas: 4
